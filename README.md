# 刷新马 + 景阳岗脚本

本仓库收录了一个用于「刷新马」与「景阳岗」模块化操作的 Tampermonkey 用户脚本。脚本提供了刷新马模块、景阳岗模块以及限速检测看门狗，帮助自动化常见的页面操作。自带的控制面板提供标签式界面，可根据当前启用的模块自动聚焦，并且在刷新后保留各类统计数据。

## 目录结构

```
src/
  userscripts/
    control-panel/
      index.user.js
```

- `src/userscripts/control-panel/index.user.js`：Tampermonkey 用户脚本源文件，后续模块将集中在该控制面板脚本中维护。

## 快速开始

1. 在浏览器中安装 [Tampermonkey](https://www.tampermonkey.net/)。
2. 打开 Tampermonkey 仪表盘，点击「创建新脚本」。
3. 将 `src/userscripts/control-panel/index.user.js` 中的全部内容复制粘贴到新脚本中并保存。
4. 访问 `http://81.68.161.24/`，在页面右下角可以看到脚本面板。根据需要开启或关闭「刷新马」与「景阳岗」模块。

## 功能概览

- **刷新马模块**：定时刷新页面，当侦测到「汗血宝马」达到阈值时自动尝试牵走并记录统计数据。
- **景阳岗模块**：自动识别景阳岗地图出口，构建可持久化的路网图，并依据探索情况规划最短路径以覆盖尚未访问的方向。
- **限速看门狗**：检测「您的点击频度过快」提示，自动暂停后尝试点击「继续」恢复操作。

### 为什么自动打怪仍然使用定时器？

- 自动打怪/返回按钮多为 `<a>`，点击后会导致整页跳转。定时器无法跨页面常驻，但会在每次新页面加载时由脚本重新创建，因此不会“白跑”。
- 定时器的意义是保证在当前页面存活时间内持续扫描按钮，抢占首个可点击时机，而不是在页面跳转后继续运行。
- 若希望进一步降低负载，可在代码中延长扫描间隔或在后台标签暂停定时器，但无需移除循环本身。

## 景阳岗导航特性

- **地图指纹与别名**：针对每个地点提取稳定的出入口信息，过滤 `sid` 等易变参数，确保刷新后仍能锁定同一节点。
- **持久化路径记忆**：将探索到的节点、可行方向以及正在执行的移动请求保存到本地存储，即便整页刷新也能继续未完成的行程。
- **自动校准**：刷新后会对照历史轨迹、移动签名与最近的提示信息重新匹配当前位置，保证路线规划与实际页面保持一致。
- **容错处理**：在打怪等无地图出口的页面暂停更新，仅记录最新提示，避免误删邻接信息造成左右来回震荡。
- **调试可观测性**：关键导航状态（当前位置、待执行动作、探索进度等）会输出到浏览器控制台，便于排查运行时行为。

## 控制面板特性

- **标签式布局**：刷新马与景阳岗模块采用紧凑的标签页展示方式，界面会根据正在运行的模块自动切换标签，并在刷新后记住上次的选择。
- **数据持久化**：模块统计（例如刷新次数、掉落物明细）会在本地持久化存储，刷新页面后仍然保留，可在面板中一键清空。
- **自动构建产物**：仓库提供 `npm run build:control-panel` 命令，可将源码编译为 Tampermonkey 可直接安装的分发脚本。

## 模块扩展建议

- 每个新增模块建议以独立的 IIFE 或函数对象维护，并在控制面板中挂载启停逻辑。
- 若模块较多，可在 `control-panel` 目录内再创建子目录（例如 `modules/`）来拆分与组织代码，然后通过构建工具合并到 `index.user.js`。

## 授权许可

脚本仅用于学习与个人研究，请在遵守目标网站使用条款的前提下使用。

## 更新日志

项目更新记录请查看 [CHANGELOG.md](./CHANGELOG.md)。
